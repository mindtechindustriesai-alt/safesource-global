<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeSource - Supply Chain Platform</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00a8ff">
    <link href="https://fonts.googleapis.com/css2?family=Exo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: #00a8ff; 
            font-family: 'Exo', sans-serif; 
            height: 100vh; 
            overflow: hidden;
        }

        /* Startup Screen */
        .startup-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10000;
        }
        .startup-logo {
            font-size: 4rem; font-weight: 800; text-shadow: 0 0 20px #00a8ff;
            animation: pulse 2s infinite; margin-bottom: 10px;
        }
        .startup-partner {
            font-size: 1.5rem; font-weight: 600; color: #00ff00; 
            margin-bottom: 20px; animation: fadeIn 3s ease-in;
        }
        .loading-bar {
            width: 250px; height: 6px; background: rgba(0, 168, 255, 0.2);
            border-radius: 3px; margin-top: 20px; overflow: hidden;
        }
        .loading-progress {
            height: 100%; background: #00a8ff; animation: loading 6s ease-in-out;
        }

        /* Main App */
        .main-app { display: none; height: 100vh; background: #000; }
        .container { padding: 20px; height: 100%; display: flex; flex-direction: column; }
        
        .app-header { text-align: center; margin-bottom: 20px; }
        .app-title { font-size: 2rem; font-weight: 800; text-shadow: 0 0 10px #00a8ff; }
        .app-subtitle { font-size: 1rem; opacity: 0.8; }

        /* Role Selector */
        .role-selector {
            display: flex; justify-content: space-around; margin-bottom: 20px;
            background: rgba(0, 168, 255, 0.1); border-radius: 50px; padding: 5px;
        }
        .role-tab {
            flex: 1; padding: 12px; text-align: center; cursor: pointer;
            border-radius: 50px; transition: all 0.3s; font-weight: 600;
        }
        .role-tab.active {
            background: #00a8ff; color: #000; font-weight: 800;
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.5);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(0, 168, 255, 0.1); border-radius: 15px; padding: 20px;
            text-align: center; border: 2px solid #00a8ff;
        }
        .stat-number { font-size: 2rem; font-weight: 800; margin-bottom: 5px; }
        .stat-label { font-size: 0.9rem; opacity: 0.8; }

        /* Sections */
        .section {
            background: rgba(0, 168, 255, 0.1); border-radius: 15px; padding: 20px;
            margin-bottom: 15px; border: 2px solid #00a8ff;
        }

        /* SARS Intelligence */
        .sars-alert {
            background: rgba(255, 68, 68, 0.1); border-radius: 15px; padding: 15px;
            margin-bottom: 15px; border: 2px solid #ff4444;
        }
        .sars-email-template {
            background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px;
            margin: 10px 0; border: 1px solid #ff4444;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #00a8ff, #00ff00); color: #000;
            border: none; padding: 10px 15px; border-radius: 10px;
            font-family: 'Exo', sans-serif; font-weight: 700; cursor: pointer;
            margin: 5px; transition: all 0.3s; font-size: 0.9rem;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 168, 255, 0.4);
        }
        .btn-danger {
            background: linear-gradient(45deg, #ff4444, #ff0080); color: #fff;
        }

        .brand-footer {
            text-align: center; margin-top: auto; padding: 15px 0;
            font-size: 0.8rem; opacity: 0.7; border-top: 1px solid rgba(0, 168, 255, 0.2);
        }

        @keyframes pulse { 
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        @keyframes loading { 0% { width: 0%; } 100% { width: 100%; } }
    </style>
</head>
<body>
    <!-- Startup Screen -->
    <div class="startup-screen" id="startupScreen">
        <div class="startup-logo">SAFESOURCE</div>
        <div class="startup-partner">Powered by SureToGo √ó MindTech</div>
        <div class="loading-bar"><div class="loading-progress"></div></div>
    </div>

    <!-- Main Platform -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <div class="app-header">
                <h1 class="app-title">SAFESOURCE PLATFORM</h1>
                <p class="app-subtitle">Supply Chain Intelligence Dashboard | R800M Valuation</p>
            </div>

            <!-- Role Selection -->
            <div class="role-selector">
                <div class="role-tab active" onclick="switchRole('manufacturer')">üè≠ Manufacturer</div>
                <div class="role-tab" onclick="switchRole('farmer')">üå± Farmer</div>
                <div class="role-tab" onclick="switchRole('retailer')">üè™ Retailer</div>
                <div class="role-tab" onclick="switchRole('compliance')">üö® Compliance</div>
            </div>

            <!-- Real-time Stats Dashboard -->
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label">Products Tracked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeAlerts">0</div>
                    <div class="stat-label">Active Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="sarsReports">0</div>
                    <div class="stat-label">SARS Reports</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="revenuePotential">R0</div>
                    <div class="stat-label">Revenue Potential</div>
                </div>
            </div>

            <!-- Manufacturer View -->
            <div id="manufacturerView" class="role-view">
                <div class="section">
                    <h3>üè≠ MANUFACTURER INTELLIGENCE DASHBOARD</h3>
                    <p>Production tracking, quality control, and counterfeit intelligence</p>
                    
                    <div class="sars-alert">
                        <h4>üö® REAL-TIME COUNTERFEIT INTELLIGENCE</h4>
                        <div id="counterfeitAlerts">
                            <p style="text-align: center; opacity: 0.7; padding: 20px;">Monitoring consumer reports...</p>
                        </div>
                    </div>

                    <button class="btn" onclick="generateProductionReport()">üìä Generate Production Report</button>
                    <button class="btn" onclick="viewQualityMetrics()">‚úÖ Quality Metrics</button>
                    <button class="btn" onclick="exportManufacturerData()">üì§ Export Intelligence</button>
                </div>
            </div>

            <!-- Farmer View -->
            <div id="farmerView" class="role-view" style="display: none;">
                <div class="section">
                    <h3>üå± FARMER SUPPLY CHAIN DASHBOARD</h3>
                    <p>Harvest tracking, supply chain visibility, and payment analytics</p>
                    
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="harvestCount">0</div>
                            <div class="stat-label">Harvests Registered</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="supplyChain">4</div>
                            <div class="stat-label">Supply Nodes</div>
                        </div>
                    </div>

                    <button class="btn" onclick="registerHarvest()">üì¶ Register New Harvest</button>
                    <button class="btn" onclick="viewSupplyChain()">üõ§Ô∏è View Supply Chain</button>
                    <button class="btn" onclick="generateFarmReport()">üìà Farm Analytics</button>
                </div>
            </div>

            <!-- Retailer View -->
            <div id="retailerView" class="role-view" style="display: none;">
                <div class="section">
                    <h3>üè™ RETAILER INTELLIGENCE DASHBOARD</h3>
                    <p>Inventory management, consumer verification analytics, and brand protection</p>
                    
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="inventoryItems">0</div>
                            <div class="stat-label">Inventory Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="customerScans">0</div>
                            <div class="stat-label">Customer Scans</div>
                        </div>
                    </div>

                    <button class="btn" onclick="viewInventory()">üìã Inventory Analytics</button>
                    <button class="btn" onclick="generateRetailReport()">üìà Sales Report</button>
                    <button class="btn" onclick="manageBrandProtection()">üõ°Ô∏è Brand Protection</button>
                </div>
            </div>

            <!-- Compliance View -->
            <div id="complianceView" class="role-view" style="display: none;">
                <div class="section">
                    <h3>üö® COMPLIANCE & SARS INTELLIGENCE</h3>
                    <p>Government reporting, illicit trade monitoring, and compliance analytics</p>

                    <div class="sars-email-template">
                        <h4>üìß SARS INTELLIGENCE REPORT TEMPLATE</h4>
                        <div id="sarsEmailPreview">
                            <p style="text-align: center; opacity: 0.7; padding: 20px;">Loading recent reports...</p>
                        </div>
                        <button class="btn btn-danger" onclick="exportSARSData()">üì§ Export to SARS</button>
                        <button class="btn" onclick="generateComplianceReport()">üìä Compliance Report</button>
                    </div>

                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="highRiskStores">0</div>
                            <div class="stat-label">High-Risk Stores</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalCounterfeits">0</div>
                            <div class="stat-label">Counterfeit Reports</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Network Activity -->
            <div class="section">
                <h3>üìã REAL-TIME NETWORK ACTIVITY</h3>
                <div id="networkActivity">
                    <p style="text-align: center; opacity: 0.7; padding: 20px;">Loading network activity...</p>
                </div>
            </div>

            <div class="brand-footer">
                SafeSource Platform v3.0 - R800M Valuation Ready<br>
                <small>Powered by SureToGo √ó MindTech | Blockchain Verified</small>
            </div>
        </div>
    </div>

    <!-- Include Shared Network Core -->
    <script src="/packages/shared-network/network.js"></script>
    <script src="/packages/blockchain/blockchain.js"></script>

    <script>
        // Platform Initialization
        setTimeout(() => {
            document.getElementById('startupScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            initializePlatform();
        }, 6000);

        let platformData = {};

        function initializePlatform() {
            console.log('üè¢ SafeSource Platform: INITIALIZED');
            loadDashboardData();
            startRealTimeUpdates();
            
            // Auto-load intelligence data
            setTimeout(loadSARSIntelligence, 2000);
        }

        function switchRole(role) {
            // Update UI
            document.querySelectorAll('.role-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.role-view').forEach(view => view.style.display = 'none');
            document.getElementById(role + 'View').style.display = 'block';
            
            // Role-specific data loading
            if (role === 'manufacturer') loadManufacturerData();
            if (role === 'compliance') loadComplianceData();
            if (role === 'farmer') loadFarmerData();
            if (role === 'retailer') loadRetailerData();
        }

        function loadDashboardData() {
            const networkStats = window.safeSourceNetwork.getNetworkStats();
            const blockchainStats = window.blockchainLedger.getBlockchainStats();
            
            // Update dashboard stats
            document.getElementById('totalProducts').textContent = networkStats.totalVerifications;
            document.getElementById('activeAlerts').textContent = networkStats.highRiskStores;
            document.getElementById('sarsReports').textContent = networkStats.totalSARSReports;
            document.getElementById('revenuePotential').textContent = 'R' + networkStats.revenuePotential.toLocaleString();
            
            // Update role-specific stats
            document.getElementById('highRiskStores').textContent = networkStats.highRiskStores;
            document.getElementById('totalCounterfeits').textContent = networkStats.totalSARSReports;
            document.getElementById('harvestCount').textContent = Math.floor(networkStats.totalVerifications / 10);
            document.getElementById('inventoryItems').textContent = networkStats.totalVerifications;
            document.getElementById('customerScans').textContent = networkStats.recentActivity;
            
            // Update network activity
            updateNetworkActivity(networkStats);
        }

        function loadSARSIntelligence() {
            const networkStats = window.safeSourceNetwork.getNetworkStats();
            const alertsContainer = document.getElementById('counterfeitAlerts');
            const emailContainer = document.getElementById('sarsEmailPreview');
            
            if (networkStats.totalSARSReports > 0) {
                alertsContainer.innerHTML = `
                    <div style="text-align: center; padding: 10px;">
                        <div style="font-size: 2rem;">üö®</div>
                        <div style="font-weight: 800; color: #ff4444;">${networkStats.totalSARSReports} ACTIVE REPORTS</div>
                        <p>${networkStats.highRiskStores} high-risk stores identified</p>
                        <p>Revenue potential: <strong>R${networkStats.revenuePotential}</strong></p>
                    </div>
                `;
                
                emailContainer.innerHTML = `
                    <p><strong>To:</strong> illicittrade@sars.gov.za</p>
                    <p><strong>Subject:</strong> SafeSource Intelligence Report - ${new Date().toLocaleDateString()}</p>
                    <p><strong>Body:</strong><br>
                    Total Reports: ${networkStats.totalSARSReports}<br>
                    High-Risk Stores: ${networkStats.highRiskStores}<br>
                    Estimated Value: R${networkStats.revenuePotential}<br>
                    Period: Last 7 days<br><br>
                    <em>Generated automatically by SafeSource Global Platform</em>
                    </p>
                `;
            }
        }

        function updateNetworkActivity(networkStats) {
            const container = document.getElementById('networkActivity');
            const activities = [
                `${networkStats.recentActivity} verifications in last 24h`,
                `${networkStats.totalSARSReports} SARS intelligence reports`,
                `${networkStats.highRiskStores} high-risk stores monitored`,
                `Blockchain: ${window.blockchainLedger.getBlockchainStats().totalBlocks} blocks`
            ];
            
            container.innerHTML = activities.map(activity => `
                <div style="padding: 8px; border-bottom: 1px solid rgba(0, 168, 255, 0.2);">
                    ‚úÖ ${activity}
                </div>
            `).join('');
        }

        function startRealTimeUpdates() {
            setInterval(loadDashboardData, 10000); // Update every 10 seconds
        }

        // Manufacturer Functions
        function generateProductionReport() {
            const report = {
                timestamp: new Date().toISOString(),
                productsVerified: window.safeSourceNetwork.getNetworkStats().totalVerifications,
                counterfeitsDetected: window.safeSourceNetwork.getNetworkStats().totalSARSReports,
                revenueImpact: window.safeSourceNetwork.getNetworkStats().revenuePotential
            };
            
            alert('üìä Production Report Generated!\n\nProducts Verified: ' + report.productsVerified + 
                  '\nCounterfeits Detected: ' + report.counterfeitsDetected +
                  '\nRevenue Impact: R' + report.revenueImpact);
        }

        function exportSARSData() {
            const networkStats = window.safeSourceNetwork.getNetworkStats();
            const emailBody = `Total Reports: ${networkStats.totalSARSReports}\nHigh-Risk Stores: ${networkStats.highRiskStores}\nEstimated Value: R${networkStats.revenuePotential}`;
            
            alert('üì§ SARS Data Ready for Export!\n\nCopy this data to send to SARS:\n\n' + emailBody);
        }

        // Additional platform functions
        function loadManufacturerData() {
            console.log('Loading manufacturer data...');
        }

        function loadComplianceData() {
            console.log('Loading compliance data...');
        }

        function loadFarmerData() {
            console.log('Loading farmer data...');
        }

        function loadRetailerData() {
            console.log('Loading retailer data...');
        }

        // Placeholder functions for other buttons
        function viewQualityMetrics() { alert('‚úÖ Quality metrics dashboard loading...'); }
        function exportManufacturerData() { alert('üì§ Exporting manufacturer intelligence data...'); }
        function registerHarvest() { alert('üì¶ New harvest registration form loading...'); }
        function viewSupplyChain() { alert('üõ§Ô∏è Supply chain visualization loading...'); }
        function generateFarmReport() { alert('üìà Farm analytics report generating...'); }
        function viewInventory() { alert('üìã Inventory analytics dashboard loading...'); }
        function generateRetailReport() { alert('üìà Retail sales report generating...'); }
        function manageBrandProtection() { alert('üõ°Ô∏è Brand protection dashboard loading...'); }
        function generateComplianceReport() { alert('üìä Compliance report generating...'); }
    </script>
</body>
</html>
